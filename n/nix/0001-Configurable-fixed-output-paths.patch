From 22630f7905f26eb6bdc83127416b5bd6d4aa88f8 Mon Sep 17 00:00:00 2001
From: "William A. Kennington III" <william@wkennington.com>
Date: Mon, 6 Aug 2018 10:34:15 -0700
Subject: [PATCH 01/10] Configurable fixed output paths

---
 src/libstore/build.cc   | 4 ++++
 src/libstore/globals.hh | 3 +++
 2 files changed, 7 insertions(+)

diff --git a/src/libstore/build.cc b/src/libstore/build.cc
index 1443e99e..2af1ce08 100644
--- a/src/libstore/build.cc
+++ b/src/libstore/build.cc
@@ -1904,6 +1904,10 @@ void DerivationGoal::startBuilder()
         PathSet dirs = settings.sandboxPaths;
         PathSet dirs2 = settings.extraSandboxPaths;
         dirs.insert(dirs2.begin(), dirs2.end());
+        if (fixedOutput) {
+          PathSet dirs3 = settings.fixedOutputSandboxPaths;
+          dirs.insert(dirs3.begin(), dirs3.end());
+        }
 
         dirsInChroot.clear();
 
diff --git a/src/libstore/globals.hh b/src/libstore/globals.hh
index f589078d..32004358 100644
--- a/src/libstore/globals.hh
+++ b/src/libstore/globals.hh
@@ -205,6 +205,9 @@ public:
         "Additional paths to make available inside the build sandbox.",
         {"build-extra-chroot-dirs", "build-extra-sandbox-paths"}};
 
+    Setting<PathSet> fixedOutputSandboxPaths{this, {}, "fixed-output-sandbox-paths",
+        "The paths to make available inside the build sandbox of fixed output derivations."};
+
     Setting<size_t> buildRepeat{this, 0, "repeat",
         "The number of times to repeat a build in order to verify determinism.",
         {"build-repeat"}};
-- 
2.19.0.605.g01d371f741-goog

